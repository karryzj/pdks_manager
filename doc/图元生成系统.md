# 图元生成系统

### 新建图元分类

在主窗口左侧空白区域，鼠标右键->新建分类，输入分类名称。**注意图元分类的名称和图元的名称，只能用大小写字母+数字+下划线，不能有空格等字符。**

### 修改图元分类名称

双击图元分类，修改图元分类名称。

### 删除图元分类

选中图元分类，在图元分类上鼠标右键->删除分类。

### 新建图元

选中图元分类，在图元分类上鼠标右键->新建图元，选择类型为“附着树类型”（python类型待开发），输入图元名称。**注意图元分类的名称和图元的名称，只能用大小写字母+数字+下划线，不能有空格等字符。**

### 修改图元名称

双击图元，修改图元名称。

## 编辑图元

主窗口左侧选中图元，在右侧窗口点击“**编辑**”按钮，弹出图元编辑窗口

![image-20240919095945020](.\图元生成系统.assets\image-20240919095945020.png)

### 新建图层

在窗口左下角图层小窗口中，点击“**新增**”按钮，会自动生成一个新图层

### 修改图层样式

双击图层，修改图层样式

### 删除图层

选中需要删除的图层，点击下方“**删除**”按钮。

### 隐藏/显示图层

在左下角图层小窗口中，不勾选指定图层则在画图区域隐藏该图层所有图形，勾选则显示该图层图形，默认勾选。

### 新增参数

在窗口右上角参数列表小窗口中，点击“**新增**”按钮，输入参数名称、默认值、描述，参数名称以大小写字母开头，可加下划线和数字。其中`_pi，`_e是默认内置参数，x、y是关键字，名称不能取该值以及不能和内置函数名称相同。默认值可以是整数或小数，也可以是表达式，例如先定义w，默认值为1，再定义h，默认值为w+1。

表达式支持内置的函数，包括如下：

```c++
sin,cos,tan,asin,acos,atan,atan2,sinh,cosh,tanh,asinh,acosh,atanh,log2,log10,log,ln,exp,sqrt,sign,rint,abs,sum,avg,min,max
```



### 修改参数

双击需要修改的参数行，进行修改操作

### 删除参数

选中需要删除的参数行，点击“**删除**”按钮。删除需要注意顺序，例如先定义w，默认值为1，再定义h，默认值为w+1，此时必须先删除参数h，再删除参数w。

### 新增参数约束

右侧窗口参数约束小窗口中，点击“**新增**”按钮，输入参数约束表达式，例如“w<1”，其中w必须为上面已经定义过的参数。如果是“1<w<5”，需要分两个表达式，“1<w”、“w<5”。**注意参数约束必须为逻辑表达式**。

### 修改参数约束

双击参数约束行进行修改。

### 删除参数约束

选中参数约束行，点击“**删除**”按钮进行删除。

### 新增指定图形

首先选中一个附着点（刚开始只有坐标原点[0,0]的root附着点），然后点击工具栏中的基础图形，修改图形参数，点击“**OK**”按钮则在窗口中间画出该图形。

- type：location为定位，主要作用是新增附着点，给其他图形做定位作用，不在实际版图中绘制；add为往版图中加指定layer的图形，del为从版图中删除指定layer的图形

- layer：指定图形使用的图层，type为add或del时可用，location时该参数无效。

- direction type option：指定图形加在附着点的相对位置，左上、右上、左下、右下。四边形，矩形，直角三角形中使用到该参数。

- rotate：图形旋转的角度，圆没有该参数。

- 其他参数为各图形独有参数，如长宽，半径等

### 新增矩形

选中一个附着点，点击工具栏中的“**rectangle**”按钮，输入宽和高，点击“**OK**”按钮。

选中一个附着点，按住鼠标拖动一个矩形。

按住Ctrl键，鼠标左键点击画图区域任意一点，则会自动增加一个从坐标原点[0,0]到该点的矩形。

### 新增多边形

选中一个附着点，点击工具栏中的“**polygen**”按钮，然后依次在画布中点击多个点，双击或按Enter健结束，弹出多边形属性框，点击“**OK**”按钮，则出现一个以附着点+顺序添加的多个点组成的多边形，此时的多边形为固定参数的多边形，多边形各顶点的x、y为浮点数。在画布中点击多个点时，如果按住Shift健，移动鼠标时则新添加的点与上一个点同x或同y。

双击弹出的属性窗口中，如果勾选选中“is extract param”，则会自动提取多边形参数，点击确定后，新增的参数自动添加到全局参数列表中。从固定参数的多边形变为有参数的多边形后，不能再变回固定参数的多边形。

### 修改图形

在中间画图区域，直接双击需要修改的图形。或者在窗口左侧图元树形结构中，右键选中图形弹出菜单，选择“attribute”进行修改。

### 删除图形

在中间画图区域，选中图形，点击键盘“**Delete**”按钮进行删除，注意删除图形时，挂在图形附着点下的所有子树图形都会被删除。或者在窗口左侧图元树形结构中，选中需要删除的图形，点击键盘“**Delete**”按钮进行删除。

### 选中图形

直接在中间画图区域选中图形。在窗口左侧图元树形结构中，选中图形。左侧树形结构中选中，中间画图区域会同步选中；中间画图区域选中，左侧树形结构中也会同步选中。

### 旋转图形

选中图形，鼠标右键->rotate，弹出框中输入要旋转的角度，旋转类型rotate by/rotate to，include children/only self

选中only self时只操作选中图形的rotate属性，等同于双击修改rotate；include children操作相当于批量设置该图形及其子节点的rotate属性

- 当设置旋转角度45°，rotate by，include children时，表示把当前图形以及该图形所有子树上的图形，当前旋转角度再旋转45°角

- 当设置旋转角度45°，rotate to，include children时，表示把当前图形以及该图形所有子树上的图形，旋转角度都设为45°角

### 复制图形

首先选中需要复制的图形，右键菜单拷贝或者快捷键ctrl+c，然后选中一个附着点，右键菜单黏贴或者ctrl+v，则完成将图形及其子树拷贝到选中附着点上。

注意附着点不能选择选中图形及其子树上的附着点。

### 选中附着点

直接在中间画图区域选中附着点所属的图形，此时该图形所有附着点都显示，再选择其中一个附着点。在窗口左侧图元树形结构中，直接点击选中附着点。左侧树形结构中选中，中间画图区域会同步选中；中间画图区域选中，左侧树形结构中也会同步选中。

### 新增锚点

选中一个附着点，鼠标右键->设为锚点，在窗口右下角锚点列表中会新增一个条目。

### 删除锚点

在窗口右下角锚点列表中选择需要删除的锚点列表，点击下方“**删除**”按钮。

### 修改坐标锚点

一个图元中只有一个坐标锚点，默认为(0,0)。如果需要修改坐标锚点，则选中一个附着点，鼠标右键->设为坐标锚点，窗口右侧坐标点中会更新坐标锚点信息。

### 导入图元

选中一个附着点，点击工具栏中的“**import**”按钮，在弹出窗口中选择需要导入的图元分类和名称，点击“**OK**”按钮即可将指定的图元插入当前附着点。

### 附着点测距

点击工具栏中的“**ruler**”按钮，然后依次选中两个附着点，会自动弹出两个附着点间的x、y方向的表达式距离和实际距离。

### 右键菜单

在中间画图区域选中图形，鼠标右键，和在左侧树形结构中选中图形，鼠标右键，弹出的菜单一致，可以进行“**剪切**”、“**拷贝**”、“**旋转**”、“**属性**”操作。

在中间画图区域选中附着点，鼠标右键，和在左侧树形结构中选中附着点，鼠标右键，弹出的菜单一致，可以进行“**黏贴**”、“**设为锚点**”、“**设为坐标锚点**”操作

### 快捷键

- ctrl + c：需要先选中图形，再按快捷键，拷贝图形（包括子树）
- ctrl + v ：需要先选中附着点，再按快捷键，黏贴已拷贝的图形
- ctrl + x :  需要先选中图形，再按快捷键，剪切图形（包括子树）
- ctrl + s：保存图元文件
- 鼠标滚轮：放大或缩小画图区域
- 键盘上下左右健：移动画图区域
- r：恢复到坐标原点视图
- f：将视图自适应大小和位置







